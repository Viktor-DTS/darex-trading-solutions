# Запланований дохід в аналітиці

## Опис функціональності

Додано нову функціональність "Запланований дохід" до аналітичної панелі, яка показує потенційний дохід від заявок, що мають статус "виконанні" але ще не підтверджені усіма учасниками процесу.

## Логіка роботи

### Що включається в запланований дохід:
- Заявки зі статусом "Виконано"
- Заявки, які НЕ підтверджені хоча б одним з учасників:
  - Зав. склад (warehouse)
  - Бухгалтер (accountant) 
  - Регіональний керівник (regional manager)

### Що НЕ включається в запланований дохід:
- Заявки, які підтверджені усіма учасниками (вони вже враховані в підтвердженому доході)

## Розрахунок запланованого доходу

### Дохід по роботам:
```
Запланована премія = (workPrice / 4) * 3
```

### Дохід по матеріалам:
```
Запланований дохід по матеріалам = (oilTotal + filterSum + fuelFilterSum + airFilterSum + antifreezeSum + otherSum) / 4
```

## Відображення в інтерфейсі

### 1. KPI блоки
- **Запланований дохід** - синій блок з розбивкою на роботи та матеріали
- Розташований між "Загальним доходом" та "Загальними витратами"

### 2. Таблиця "Динаміка по місяцях"
- Додана нова колонка "Запланований дохід"
- Показує загальну суму та розбивку по роботах та матеріалам

### 3. Детальна аналітика
- Графік доходів тепер включає запланований дохід
- Запланований дохід відображається синім кольором поверх підтверджених доходів

## API зміни

### Новий endpoint:
```
GET /api/analytics/planned-revenue
```

### Оновлений endpoint:
```
GET /api/analytics/full
```
Тепер включає поля:
- `plannedWorkRevenue` - запланований дохід по роботах
- `plannedMaterialsRevenue` - запланований дохід по матеріалам  
- `plannedRevenue` - загальний запланований дохід

## Автоматичне оновлення

Запланований дохід автоматично оновлюється:
- Коли заявка отримує всі необхідні підтвердження
- Коли змінюються фільтри аналітики
- При оновленні сторінки

## Переваги

1. **Планування** - можливість бачити потенційний дохід
2. **Контроль** - відстеження заявок, що потребують підтвердження
3. **Аналітика** - повна картина фінансового стану
4. **Автоматизація** - автоматичне перерахування при зміні статусів

## Технічні деталі

### Backend:
- Новий API endpoint для запланованого доходу
- Оновлена логіка розрахунку в повній аналітиці
- Розділення підтверджених та запланованих доходів

### Frontend:
- Оновлений компонент AnalyticsArea
- Оновлений компонент DetailedAnalyticsArea  
- Додано нові поля в розрахунки та відображення
- Оновлені графіки та таблиці

## Приклад використання

1. Відкрийте розділ "Аналітика"
2. Встановіть потрібні фільтри (регіон, компанія, період)
3. Перегляньте блок "Запланований дохід"
4. Аналізуйте детальну динаміку в таблиці
5. Використовуйте детальну аналітику для графічного представлення

## Примітки

- Запланований дохід розраховується тільки для заявок зі статусом "Виконано"
- При підтвердженні заявки усіма учасниками, вона автоматично переходить з запланованого в підтверджений дохід
- Розрахунки враховують всі матеріальні витрати та вартість робіт
